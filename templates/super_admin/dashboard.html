{% extends 'base.html' %}

{% block title %}Super Admin Dashboard{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Painel do Super Administrador</h1>
    <p>Bem-vindo ao painel de controle geral do sistema. Use os links abaixo para gerenciar as escolas e as permissões de administrador.</p>
    
    <div class="list-group mb-4">
        <a href="{{ url_for('super_admin.manage_schools') }}" class="list-group-item list-group-item-action">
            Gerenciar Escolas
        </a>
        <a href="{{ url_for('super_admin.manage_assignments') }}" class="list-group-item list-group-item-action">
            Gerenciar Atribuições de Escola (Admin, Aluno, Instrutor)
        </a>
    </div>

    <h2 class="mb-3">Visualizar Dados por Escola</h2>
    <form method="GET" action="{{ url_for('super_admin.dashboard') }}" class="mb-4">
        <div class="row g-3 align-items-end">
            <div class="col-md-6">
                <label for="school_select" class="form-label">Selecione uma Escola:</label>
                <select class="form-select" id="school_select" name="school_id" onchange="this.form.submit()">
                    <option value="">-- Selecione --</option>
                    {% for school in all_schools %}
                        <option value="{{ school.id }}" {% if selected_school and selected_school.id == school.id %}selected{% endif %}>
                            {{ school.nome }}
                        </option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-6">
                {% if selected_school %}
                    <p class="form-text text-muted">Exibindo dados para: <strong>{{ selected_school.nome }}</strong></p>
                {% else %}
                    <p class="form-text text-muted">Selecione uma escola para ver seus detalhes.</p>
                {% endif %}
            </div>
        </div>
    </form>

    {% if selected_school %}
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="card-title mb-0">Administradores da Escola: {{ selected_school.nome }}</h3>
            </div>
            <div class="card-body">
                {% if admin_escola_users %}
                    <ul class="list-group">
                        {% for user in admin_escola_users %}
                            <li class="list-group-item">{{ user.nome_completo or user.username }} (ID: {{ user.id_func }})</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Nenhum administrador de escola encontrado para esta escola.</p>
                {% endif %}
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <h3 class="card-title mb-0">Alunos da Escola: {{ selected_school.nome }}</h3>
            </div>
            <div class="card-body">
                {% if alunos %}
                    <ul class="list-group">
                        {% for user in alunos %}
                            <li class="list-group-item">{{ user.nome_completo or user.username }} (ID: {{ user.id_func }})</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Nenhum aluno encontrado para esta escola.</p>
                {% endif %}
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-header">
                <h3 class="card-title mb-0">Instrutores da Escola: {{ selected_school.nome }}</h3>
            </div>
            <div class="card-body">
                {% if instrutores %}
                    <ul class="list-group">
                        {% for user in instrutores %}
                            <li class="list-group-item">{{ user.nome_completo or user.username }} (ID: {{ user.id_func }})</li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p>Nenhum instrutor encontrado para esta escola.</p>
                {% endif %}
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
